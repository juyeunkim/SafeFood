<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Reveal Bootstrap Template</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="" name="keywords">
<meta content="" name="description">

<!-- Favicons -->
<link href="img/favicon.png" rel="icon">
<link href="img/apple-touch-icon.png" rel="apple-touch-icon">

<!-- Google Fonts -->
<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700"
	rel="stylesheet">

<!-- Bootstrap CSS File -->
<link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- Libraries CSS Files -->
<link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="lib/animate/animate.min.css" rel="stylesheet">
<link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
<link href="lib/owlcarousel/assets/owl.carousel.min.css"
	rel="stylesheet">
<link href="lib/magnific-popup/magnific-popup.css" rel="stylesheet">
<link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">

<!-- Main Stylesheet File -->
<link href="css/style.css" rel="stylesheet">
<link href="css/taemin.css" rel="stylesheet">

<!-- Chart.js -->
<script type="text/javascript" src="Chart/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="Chart/Chart.js"></script>

<!-- =======================================================
    Theme Name: Reveal
    Theme URL: https://bootstrapmade.com/reveal-bootstrap-corporate-template/
    Author: BootstrapMade.com
    License: https://bootstrapmade.com/license/
  ======================================================= -->
</head>

<body id="body">

	<!--==========================
    Top Bar
  ============================-->
	<section id="topbar" class="d-none d-lg-block">
		<div class="container clearfix">
			<div class="contact-info float-left">
				
			</div>
			<div class="social-links float-right">
				<a href="#" id="logout" onclick="logout();">로그아웃</a> <a href="#"
					id="userinfo" onclick="userinfo();">회원정보</a>
			</div>
		</div>
	</section>

	<!--==========================
    Header
  ============================-->
	<header id="header">
		<div class="container">
			<div id="logo" class="pull-left">
				<a href="#" onclick="home();"><img src="https://lab.ssafy.com/uploads/-/system/appearance/header_logo/1/ssafy_logo.png"  alt="" title="" /></a>
			</div>

			<nav id="nav-menu-container">
				<ul class="nav-menu">
					<!-- <li class="menu-active"><a href="#body">Home</a></li> -->
					<li><a href="#about">공지 사항</a></li>
					<li><a href="#services" onclick="productinfo();">상품 정보</a></li>
					<li><a href="#portfolio">베스트 섭취 정보</a></li>
					<li><a href="#team">내 섭취 정보</a></li>
					<li><a href="#contact">예상 섭취 정보</a></li>
				</ul>
			</nav>
			<!-- #nav-menu-container -->
		</div>
	</header>
	<!-- #header -->

	<main id="main"> <!-- #services --> <!--==========================
      Services Section
    ============================-->
	<section id="services">
		<div class="container" id="id_container">
			<div class="section-header">
				</br> </br>
				<h2>제품 상세 정보</h2>
			</div>
			<div class="row">

				<div class="col-lg-12">
					<div class=" box3 wow fadeInLeft row" id="tableSection">
						<div class="col-lg-4">
							<img src="img/about-img.jpg" width="300px">
						</div>
						<div class="col-lg-8">

							<table class="table">
								<tr>
									<td width="30%">제품명</td>
									<td>아카페라아메리카노</td>
								</tr>
								<tr>
									<td width="30%">제조사</td>
									<td>빙그레</td>
								</tr>
								<tr>
									<td width="30%">원재료</td>
									<td>뭐시기뭐시기뭐시기무서ㅣ기만어리나어리ㅏㄴ어리ㅏ넝리ㅏㅓㄴㅇ리</td>
								</tr>
								<tr>
									<td width="30%">알레르기성분</td>
									<td>알레르기붬니아ㅓ리ㅏㄴ어리ㅏㄴ어리ㅏ</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

	</section>
	<!-- #services --> </main>
	<!-- #chart -->
	</br></br></br></br>
	<div class="row">
		<div class="col-lg-1"></div>
		<canvas class="col-lg-6" id="myChart"></canvas>
		<div class="col-lg-4" id ="tableChart"></div>
	</div>
	</br></br></br></br>

	<!--==========================
    Footer
  ============================-->
	<footer id="footer">
		<div class="container">
			<div class="copyright">
				&copy; Copyright <strong>Reveal</strong>. All Rights Reserved
			</div>
			<div class="credits">
				<!--
          All the links in the footer should remain intact.
          You can delete the links only if you purchased the pro version.
          Licensing information: https://bootstrapmade.com/license/
          Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=Reveal
        -->
				Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
			</div>
		</div>
	</footer>
	<!-- #footer -->

	<a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

	<!-- JavaScript Libraries -->
	<script src="lib/jquery/jquery.min.js"></script>
	<script src="lib/jquery/jquery-migrate.min.js"></script>
	<script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="lib/easing/easing.min.js"></script>
	<script src="lib/superfish/hoverIntent.js"></script>
	<script src="lib/superfish/superfish.min.js"></script>
	<script src="lib/wow/wow.min.js"></script>
	<script src="lib/owlcarousel/owl.carousel.min.js"></script>
	<script src="lib/magnific-popup/magnific-popup.min.js"></script>
	<script src="lib/sticky/sticky.js"></script>

	<!-- Contact Form JavaScript File -->
	<script src="contactform/contactform.js"></script>

	<!-- Template Main Javascript File -->
	<script src="js/main.js"></script>
	<script src="js/main.js"></script>

	<script type="text/javascript">
		function logout() {

			window.location.href = "login.html";

		}
		function userinfo() {

			window.location.href = "userInformation.html";

		}

		function productinfo() {

			window.location.href = "itemList.html";

		}
		function home() {
			window.location.href = "logout.html";
		}
	</script>
	<script type="text/javascript" src='./js/jquery-3.3.1.js'></script>
	<script type="text/javascript">
	var code = 1;
	var naem = "";
	
	
	$(function() {
		
		var temp = location.href.split("?");
		data = temp[1].split(":");
		code = data[1];
		
		$.ajax({
			url : 'res/foodInfo.xml',
			success : processResult,
			error : function(err){
				
				console.log(err);
			}

		})
		
		 $.ajax({
			url : 'res/FoodNutritionInfo.xml',
			success : processChart,
			error : function(err){
				
				console.log(err);
			}

		}) 
		
		
	
});
function processResult(xmlData, status, xhr){
	var errorMsg = $('error',xmlData).text(); //<error>의 body 정보 추출
	if(errorMsg !=''){ //error가 발생한경우 
		alert(errorMsg);
	}else{
	
		var html= "";
		$('#tableSection').empty();
		//서버로 부터 받은 xml데이터에서 data태그를 찾기
		$('food',xmlData).each(function(index, item){
			var myCode = $('code',item).text();
			if(myCode == code){
				html+= '<div class="col-lg-4"><img src="';
				html+= $('image',item).text();
				html+= '" width="300px"> ';
				html+= '</div><div class="col-lg-8"><table class="table"><tr ><td width = "30%">제품명</td><td>'
				html+= $('name',item).text();
				html+= '</td></tr><tr><td width = "30%">제조사</td><td>';
				html+= $('maker',item).text();
				html+= '</td></tr><tr><td width = "30%">원재료</td><td>';
				html+= $('material',item).text();
				var contents = $('material',item).text();
				
				html+= '</td></tr><tr><td width = "30%"> 알레르기성분</td><td>';
				// 알레르기 
				var allergys=["대두","땅콩","우유","게","새우","참치","연어","쑥","소고기","닭고기","돼지고기","복숭아","민들레","계란흰자"];
				for (let el of allergys) {
					console.log(el);
					if(contents.indexOf(el) != -1){
						html+= el+", "
					}
				}
				html+= '</td></tr></table></div>';
				name = $('name',item).text();
			}
			
		});
		$('#tableSection').append(html);
	}
}

function processChart(xmlData, status, xhr){
	var errorMsg = $('error',xmlData).text(); //<error>의 body 정보 추출
	if(errorMsg !=''){ //error가 발생한경우 
		alert(errorMsg);
	}else{
		console.log("taemin");
		var html= "";
		//서버로 부터 받은 xml데이터에서 data태그를 찾기
		$('item',xmlData).each(function(index, item){
			var myCode = $('DESC_KOR',item).text();
			console.log(myCode);
			if(myCode == name){
				var serving_wt = $('SERVING_WT',item).text();
				var nutr_cont1 = $('NUTR_CONT1',item).text();
				var nutr_cont2 = $('NUTR_CONT2',item).text();
				var nutr_cont3 = $('NUTR_CONT3',item).text();
				var nutr_cont4 = $('NUTR_CONT4',item).text();
				var nutr_cont5 = $('NUTR_CONT5',item).text();
				var nutr_cont6 = $('NUTR_CONT6',item).text();
				var nutr_cont7 = $('NUTR_CONT7',item).text();
				var nutr_cont8 = $('NUTR_CONT8',item).text();
				var nutr_cont9 = $('NUTR_CONT9',item).text();
				makeChart(serving_wt,nutr_cont1,nutr_cont2,nutr_cont3,nutr_cont4,nutr_cont5,nutr_cont6,nutr_cont7,nutr_cont8,nutr_cont9);
			}
			
		});
		
		
	}
}

function makeChart(wt,nutr1,nutr2,nutr3,nutr4,nutr5,nutr6,nutr7,nutr8,nutr9){
	var ctx = document.getElementById("myChart");
	
	var myChart = new Chart(ctx,
			{
				type : "pie",
				data : {
					labels : [ "Carbo", "Protein", "Fat",  "Chole",
							"TransFat" ],
					datasets : [ {
						label : "#pieChart",
						data : [ nutr2, nutr3, nutr4,  nutr7, nutr9 ],
						backgroundColor : [ "rgba(255, 99, 132, 0.2)",
								"rgba(54, 162, 235, 0.2)",
								"rgba(255, 206, 86, 0.2)",
								"rgba(75, 192, 192, 0.2)",
								"rgba(153, 102, 255, 0.2)"],
						borderColor : [ "rgba(255, 99, 132, 1)",
								"rgba(54, 162, 235, 1)",
								"rgba(255, 206, 86, 1)",
								"rgba(75, 192, 192, 1)",
								"rgba(153, 102, 255, 1)"],
						borderWidth : 1
					} ]
				},
				options : {

				}
			});
	
	var html= "";
	//서버로 부터 받은 xml데이터에서 data태그를 찾기
	
	html+= '<table class="table"><tr ><td width = "30%">일일제공량</td><td>';
	html+= wt;
	html+= '</td></tr><tr><td width = "30%">칼로리</td><td>';
	html+= nutr1;
	html+= '</td></tr><tr><td width = "30%">탄수화물</td><td>';
	html+= nutr2;
	html+= '</td></tr><tr><td width = "30%">단백질</td><td>';
	html+= nutr3;
	html+= '</td></tr><tr><td width = "30%">지방</td><td>';
	html+= nutr4;
	html+= '</td></tr><tr><td width = "30%">당류</td><td>';
	html+= nutr5;
	html+= '</td></tr><tr><td width = "30%">나트륨</td><td>';
	html+= nutr6;
	html+= '</td></tr><tr><td width = "30%">콜레스테롤</td><td>';
	html+= nutr7;
	html+= '</td></tr><tr><td width = "30%">포화지방산</td><td>';
	html+= nutr8;
	html+= '</td></tr><tr><td width = "30%">트랜스지방</td><td>';
	html+= nutr9;
	html+= '</td></tr></table>';
	$('#tableChart').append(html);
		}
		
	</script>
</body>
</html>
